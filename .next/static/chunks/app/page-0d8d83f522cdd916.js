(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6104:function(e,t,n){Promise.resolve().then(n.bind(n,5064))},5064:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var l=n(7437),r=n(2265);let a=(0,n(4593).eI)("https://pryvikdgobvloktselzd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByeXZpa2Rnb2J2bG9rdHNlbHpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDYzOTYsImV4cCI6MjA2OTUyMjM5Nn0.uJrJW5mz9w65PXqnEscHndo0L4XHTe_tIrxMckhSkUQ");function s(){var e;let[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)([]),[d,c]=(0,r.useState)(null),[u,b]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!0),p=()=>{let e=[];for(let t=1;t<=41;t++)e.push({table_number:t,zone:"inside",position:{x:0,y:0},is_booked:!1});for(let t=42;t<=65;t++)e.push({table_number:t,zone:"outside",position:{x:0,y:0},is_booked:!1});return e},x=async()=>{try{let{data:e,error:t}=await a.from("table_bookings").select("*").order("table_number");if(t)throw t;i(e||[]);let l=p().map(t=>{let n=null==e?void 0:e.find(e=>e.table_number===t.table_number);return{...t,is_booked:!!n,booking:n}});n(l)}catch(e){console.error("Error loading bookings:",e)}finally{g(!1)}},h=async e=>{try{var n;if(null===(n=t.find(t=>t.table_number===e.table_number))||void 0===n?void 0:n.booking){let{error:t}=await a.from("table_bookings").update(e).eq("table_number",e.table_number);if(t)throw t;alert("แก้ไขข้อมูลการจองสำเร็จ!")}else{let{error:t}=await a.from("table_bookings").insert([e]);if(t)throw t;alert("จองโต๊ะสำเร็จ!")}await x(),b(!1),c(null)}catch(e){console.error("Error booking table:",e),alert("เกิดข้อผิดพลาดในการจองโต๊ะ")}},f=async e=>{if(confirm("คุณต้องการยกเลิกการจองโต๊ะนี้หรือไม่?"))try{let{error:t}=await a.from("table_bookings").delete().eq("table_number",e);if(t)throw t;await x(),alert("ยกเลิกการจองสำเร็จ!")}catch(e){console.error("Error canceling booking:",e),alert("เกิดข้อผิดพลาดในการยกเลิกการจอง")}},v=async()=>{try{let e=await fetch("/api/export");if(!e.ok)throw Error("Export failed");let t=await e.blob(),n=window.URL.createObjectURL(t),l=document.createElement("a");l.style.display="none",l.href=n,l.download="รายการจองโต๊ะ_".concat(new Date().toLocaleDateString("th-TH").replace(/\//g,"-"),".xlsx"),document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(n),document.body.removeChild(l)}catch(e){console.error("Error exporting:",e),alert("เกิดข้อผิดพลาดในการ export ข้อมูล")}};return((0,r.useEffect)(()=>{x()},[]),m)?(0,l.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-purple-900",children:(0,l.jsx)("div",{className:"text-xl text-white",children:"กำลังโหลด..."})}):(0,l.jsxs)("div",{className:"min-h-screen bg-purple-900 text-white p-4",children:[(0,l.jsxs)("div",{className:"text-center mb-8",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"ระบบจองโต๊ะงานแต่ง"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("button",{onClick:v,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 mr-4",children:"\uD83D\uDCCA Export Excel"}),(0,l.jsx)("button",{onClick:x,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"\uD83D\uDD04 รีเฟรช"})]}),(0,l.jsxs)("div",{className:"bg-black bg-opacity-50 text-white p-4 rounded-lg inline-block",children:[(0,l.jsxs)("div",{children:["จำนวนโต๊ะที่จองแล้ว: ",s.length," โต๊ะ"]}),(0,l.jsxs)("div",{children:["จำนวนโต๊ะที่จ่ายแล้ว: ",s.filter(e=>"paid"===e.payment_status).length," โต๊ะ"]})]})]}),(0,l.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4 bg-blue-600 px-4 py-2 rounded-lg",children:"ด้านนอกหอประชุม (1-27)"}),(0,l.jsx)("div",{className:"grid grid-cols-3 gap-3",children:Array.from({length:27},(e,t)=>t+1).map(e=>{var n;let r=t.find(t=>t.table_number===e);return(0,l.jsx)("button",{onClick:()=>{c(e),b(!0)},className:"\n                      w-16 h-16 rounded-full text-white font-bold text-lg transition-all hover:scale-105\n                      ".concat((null==r?void 0:r.is_booked)?(null===(n=r.booking)||void 0===n?void 0:n.payment_status)==="paid"?"bg-green-500 hover:bg-green-600":"bg-orange-500 hover:bg-orange-600":"bg-purple-400 hover:bg-purple-500","\n                    "),children:e},e)})})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4 bg-red-600 px-4 py-2 rounded-lg",children:"ด้านในหอประชุม (28-41)"}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[28,29,30,31,32,33,34,35,36,37,38,39,40,41].map(e=>{var n;let r=t.find(t=>t.table_number===e);return(0,l.jsx)("button",{onClick:()=>{c(e),b(!0)},className:"\n                      w-16 h-16 rounded-full text-white font-bold text-lg transition-all hover:scale-105\n                      ".concat((null==r?void 0:r.is_booked)?(null===(n=r.booking)||void 0===n?void 0:n.payment_status)==="paid"?"bg-green-500 hover:bg-green-600":"bg-orange-500 hover:bg-orange-600":"bg-purple-400 hover:bg-purple-500","\n                    "),children:e},e)})})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4 bg-blue-600 px-4 py-2 rounded-lg",children:"ด้านนอกหอประชุม (42-65)"}),(0,l.jsx)("div",{className:"grid grid-cols-3 gap-3",children:[42,43,44,63,64,65,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62].map(e=>{var n;let r=t.find(t=>t.table_number===e);return(0,l.jsx)("button",{onClick:()=>{c(e),b(!0)},className:"\n                      w-16 h-16 rounded-full text-white font-bold text-lg transition-all hover:scale-105\n                      ".concat((null==r?void 0:r.is_booked)?(null===(n=r.booking)||void 0===n?void 0:n.payment_status)==="paid"?"bg-green-500 hover:bg-green-600":"bg-orange-500 hover:bg-orange-600":"bg-purple-400 hover:bg-purple-500","\n                    "),children:e},e)})})]})]})}),u&&d&&(0,l.jsx)(o,{tableNumber:d,zone:d<=41?"inside":"outside",existingBooking:null===(e=t.find(e=>e.table_number===d))||void 0===e?void 0:e.booking,onSubmit:h,onClose:()=>{b(!1),c(null)},onDelete:f})]})}function o(e){let{tableNumber:t,zone:n,onSubmit:a,onClose:s,onDelete:o,existingBooking:i}=e,[d,c]=(0,r.useState)({guest_name:(null==i?void 0:i.guest_name)||"",phone_number:(null==i?void 0:i.phone_number)||"",party_size:(null==i?void 0:i.party_size)||8,payment_status:(null==i?void 0:i.payment_status)||"booked",notes:(null==i?void 0:i.notes)||""});return(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,l.jsxs)("h3",{className:"text-xl font-bold mb-4 text-gray-800",children:[i?"แก้ไข":"จอง","โต๊ะ ",t," (","inside"===n?"ด้านใน":"ด้านนอก",")"]}),(0,l.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!d.guest_name.trim()||!d.phone_number.trim()){alert("กรุณากรอกข้อมูลให้ครบถ้วน");return}a({table_number:t,guest_name:d.guest_name.trim(),phone_number:d.phone_number.trim(),party_size:d.party_size,payment_status:d.payment_status,booking_date:(null==i?void 0:i.booking_date)||new Date().toISOString(),notes:d.notes.trim(),zone:n})},className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"ชื่อผู้จอง *"}),(0,l.jsx)("input",{type:"text",value:d.guest_name,onChange:e=>c(t=>({...t,guest_name:e.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-800",placeholder:"กรอกชื่อผู้จอง",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"เบอร์โทรศัพท์ *"}),(0,l.jsx)("input",{type:"tel",value:d.phone_number,onChange:e=>c(t=>({...t,phone_number:e.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-800",placeholder:"กรอกเบอร์โทรศัพท์",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"จำนวนคน"}),(0,l.jsx)("input",{type:"number",min:"1",max:"12",value:d.party_size,onChange:e=>c(t=>({...t,party_size:parseInt(e.target.value)})),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-800"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"สถานะการชำระ *"}),(0,l.jsxs)("div",{className:"flex space-x-4",children:[(0,l.jsxs)("label",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"radio",name:"payment_status",value:"booked",checked:"booked"===d.payment_status,onChange:e=>c(t=>({...t,payment_status:e.target.value})),className:"mr-2"}),(0,l.jsx)("span",{className:"text-orange-600",children:"จองเฉยๆ"})]}),(0,l.jsxs)("label",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"radio",name:"payment_status",value:"paid",checked:"paid"===d.payment_status,onChange:e=>c(t=>({...t,payment_status:e.target.value})),className:"mr-2"}),(0,l.jsx)("span",{className:"text-green-600",children:"จ่ายแล้ว"})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"หมายเหตุ"}),(0,l.jsx)("textarea",{value:d.notes,onChange:e=>c(t=>({...t,notes:e.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-800",rows:3,placeholder:"หมายเหตุเพิ่มเติม (ถ้ามี)"})]}),(0,l.jsxs)("div",{className:"flex space-x-4 pt-4",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"ยกเลิก"}),i&&(0,l.jsx)("button",{type:"button",onClick:()=>{confirm("คุณต้องการลบการจองนี้หรือไม่?")&&(o(t),s())},className:"flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors",children:"ลบการจอง"}),(0,l.jsx)("button",{type:"submit",className:"flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition-colors",children:i?"บันทึกการแก้ไข":"จองโต๊ะ (2,000 บาท)"})]})]})]})})}}},function(e){e.O(0,[593,971,23,744],function(){return e(e.s=6104)}),_N_E=e.O()}]);